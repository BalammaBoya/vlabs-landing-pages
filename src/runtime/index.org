c#+TITLE: Runtime
#+AUTHOR: VLEAD
#+DATE: [2017-04-06 Thursday]
#+PROPERTY: results output
#+PROPERTY: exports code
#+SETUPFILE: ../org-templates/level-1.org
#+options: ^:nil
#+LATEX: Literal LaTeX code for export

* Introduction 
  :PROPERTIES:
  :CUSTOM_ID: introduction
  :END: 
  This "Literate Document" is an illustration of building
  =Vlabs landing Pages=. It includes updating the data in
  the web page, using =Lab Data Service=. This helps us
  achieve a lot of tasks, Some of them are mentioned below
  - It explains the approach to access the data of labs that
    are segregated based on institutes.
  - It explains the approach to access the data of labs that
    are segregated based on disciplines.
  - Accessing all the data of labs.

* Implementation
** Structure of html
   On Load, this page invokes =loadIndex()= function which
   loads the default header, content, and footer pages in
   place of =headerDiv=, =contentDiv= and =footerDiv=
   divisions.

#+NAME: main-html
#+BEGIN_SRC html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="http://files.vlabs.ac.in/lds/libraries/css/bootsnipp.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="icon" type="image/x-icon" href="http://files.vlabs.ac.in/lds/images/vlabs-logo/favicon.ico">
    <link rel="stylesheet" href="../static/css/style.css"/>
    <script type="text/javascript" src="../static/js/app-config.js"></script>
    <script type="text/javascript" src="../static/js/main.js"></script>
    <script>
      document.domain="localhost";
      window.loggedin=false;
      function displayMessage (evt) {
          var message;
          if (evt.origin !== "http://themeless.vlabs.ac.in") {
              message = "Unauthorized domain";
          }
          else {
              if (evt.data.indexOf("MY COURSES") != -1){
                  document.cookie = "loginHandler='logged in'";
                  loadAllDisciplines();
              }
              else if (evt.data.indexOf("Sign in")!= -1){
                  document.cookie = "loginHandler='logged out'";
              }
              else {
                    console.log("");
              }
           }
           if(document.cookie.includes("logged in")){
               alert("logged in");
               var loginDiv = document.getElementById("login")
               window.loggedin=true;
               loginDiv.innerHTML = "Logout";
               loginDiv.setAttribute( "onClick", "setLoginUrlInContentIframe('logout')" );
               console.log(loginDiv);
               <!-- var registerDiv = document.getElementById("register"); -->
               <!-- registerDiv.parentNode.removeChild(registerDiv); -->

           }
           else if(document.cookie.includes("logged out")){
                  document.getElementById("login").innerHTML = "Login";
                  document.getElementById("login").setAttribute( "onClick", "setLoginUrlInContentIframe('login')" );
           }
           else{
                console.log("");
           }
      }
      if (window.addEventListener) {
          // For standards-compliant web browsers
          window.addEventListener("message", displayMessage, false);
      }
      else {
          window.attachEvent("onmessage", displayMessage);
      }
    </script>    
    <title>Virtual Labs</title>    
  </head>
  <body onload="loadIndex()">
    <div>
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand main-logo-a"
               href="https://vlabs.ac.in"
               style=" width:100px; height:40px;
                      margin-top:-13px">
              <img src="https://vlabs.ac.in/static/edx-bootstrap-theme/images/logo.7e034286282a.png"
                   class="img-responsive main-logo"
                   style="width:100%; maring-top:2px;"></a>
          </div>
          
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li >
                <a onclick="loadAllLabs()" "#" class="dropdown-toggle cursor-pointer" data-toggle="dropdown">All Labs <b ></b></a>
              </li>
              <li class="dropdown">
                <a class="dropdown-toggle cursor-pointer" data-toggle="dropdown"  >Institutes <b class="caret"></b></a>
                <ul class="dropdown-menu filterInstituteComboBox" id="getInstituteName" >
                </ul>
                
              <li class="dropdown">
                <a class="dropdown-toggle cursor-pointer" data-toggle="dropdown">Disciplines <b class="caret"></b></a>
                <ul  class="dropdown-menu filterDisciplineComboBox" >
                </ul>
                
              <li class="dropdown mega-dropdown">
                <a class="dropdown-toggle cursor-pointer "
                   data-toggle="dropdown">About
                  <span class="caret"></span></a>				
                <ul class="dropdown-menu mega-dropdown-menu">
                  <li class="col-sm-2">
                    <ul>
                      <li class="dropdown-header">Community</li>
                      <li><a href="#">Teachers</a></li>
                      <li><a href="#">Developers</a></li>
                      <li><a href="#">Students</a></li>
                    </ul>
                  </li>
                  <li class="col-sm-3">
                    <ul>
                      <li class="dropdown-header">Development</li>
                      <li><a href="#">Virtual Development</a></li>
                    </ul>
                  </li>
                  <li class="col-sm-2">
                    <ul>
                      <li class="dropdown-header">Workshops</li>
                      <li><a href="#">Online</a></li>
                      <li><a href="#">College Cloud Edition</a></li>
                    </ul>
                  </li>
                  <li class="col-sm-3">
                    <ul>
                      <li class="dropdown-header">FAQ</li>
                      <li><a href="#">Virtual Labs</a></li>
                      <li><a href="#">Virtuals
                          College Cloud Edition</a>
                      </li>
                      <li><a href="#">Expression  of Interest for Workshops</a></li>
                    </ul>
                  </li>
                  <li class="col-sm-2">
                    <ul>
                      <li class="dropdown-header">Information</li>
                      <li><a href="#">Announcements</a></li>
                      <li><a href="#">Contact us</a></li>
                      <li><a href="#">2017-summer-intership</a></li>
                    </ul>
                  </li>
              </li>
              </ul>
              </li>
              </li>
            </ul>
            
            <ul class="nav navbar-nav navbar-right">
              <form class="navbar-form navbar-left">
                <div  class="input-group stylish-input-group">
                  <input id="keyword" type="text" class="form-control"
                         placeholder="Lab Name">
                  <span class="input-group-addon">
                    <button type="button"
                       onclick="javascript:getLabsByKeyword()"
                       target="content_iframe" class="btn btn-default" type="submit">
                      <span class="glyphicon glyphicon-search"></span>
                    </button>
                  </span>
                </div>
              </form>
              <li><a class ="cursor-pointer" onclick="setRegisterUrlInContentIframe();"><span class="glyphicon glyphicon-user"></span>Register</a></li>
              <li><a class ="cursor-pointer" onclick="setLoginUrlInContentIframe('login');" id="login" class="glyphicon glyphicon-log-in"> Login</a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
      </div>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <img src="http://files.vlabs.ac.in/lds/images/slider-images/slider-img-01.jpg" class="img-responsive main-logo" style="width:100%; maring-top:2px;">
        </div>
      </div>

      <div>
        <div class="col-md-4"></div>
        <div style="margin-top:-217px; color:white; padding-left:5em;" class="col-md-8"><h1 class="animation animated-item-1" style="font-color:Black"><b>Online labs and experiments </b>
            from top technical institutes. Now available
            in <a href="https://info.vlabs.ac.in/college-cloud-edition/">offline
              edition</a> for your college.</h1></div>
      </div>
    </div>
</div>
</div>
</div>
<div class="container-fluid">
<div class="row">
  <div class="features">
    <div style="visibility: visible;
                animation-duration: 1000ms; animation-delay: 600ms;
                animation-name: fadeInDown;"
         class="col-md-2 col-sm-6 wow fadeInDown animated"
         data-wow-duration="1000ms" data-wow-delay="600ms">
      <div class="feature-wrap">
        <h3 class="text-h3-darkblack-bold"
            style="text-align: center;">  Labs 175<sup>+</sup> </h3>
      </div>
    </div>

    <div class="features">
      <div style="visibility: visible; animation-duration:
            1000ms; animation-delay: 600ms; animation-name:
            fadeInDown;"
           class="col-md-3 col-sm-6 wow fadeInDown animated"
           data-wow-duration="1000ms" data-wow-delay="600ms">
        <div class="feature-wrap">
          <h3 class="text-h3-darkblack-bold"
              style="text-align: center;">Experiments 1700<sup>+</sup></h3>
        </div>
      </div>

      <div style="visibility: visible; animation-duration:
              1000ms;
              animation-delay: 600ms; animation-name: fadeInDown;"
           class="col-md-3 col-sm-6 wow fadeInDown animated"
           data-wow-duration="1000ms" data-wow-delay="600ms">
        <div class="feature-wrap">
          <h3 class="text-h3-darkblack-bold"
              style="text-align: center;">
            <a onclick="setUsageInIframe()" href="#"
               class="broad-labs-a" >Usage</a>
            <span id="server_usage">6,68,971</span> <sup>+</sup></h3>
        </div>
      </div>                
      <div style="visibility: visible; animation-duration:
                  1000ms;
                  animation-delay: 600ms; animation-name: fadeInDown;"
           class="col-md-4 col-sm-6 wow fadeInDown animated"
           data-wow-duration="1000ms" data-wow-delay="600ms">
        <div class="feature-wrap">
          <h3 class="text-h3-darkblack-bold"
              style="text-align: center;">
            <a onclick="setUsageInIframe()" href="#"
               class="broad-labs-a">Workshop Usage</a>
            <span id="usage">19,88,398</span> <sup>+</sup></h3>
        </div>
      </div>
</div>


    
    <div id="contentDiv" class="container-fluid" style="padding-top:5em" >
    </div>
    <div id="footerDiv" class="container-fluid">
    </div>

</body>
</html>

#+END_SRC

** Config
   Getting data from the lab data service and feeding the
   content iframe. Also getting images of institute,
   disciplines and all labs from file server
#+NAME: app-config
#+BEGIN_SRC javascript
document.domain="localhost";
// update this to base url to lds url where your lds service was running
var base_url = "http://ld.base4.vlabs.ac.in"; 
//  var base_url = "http://localhost:5000"; 
var keyword_url = base_url+"/labs?keyword_lab_name=";
var institute_images_url ="http://files.vlabs.ac.in/lds/images/institutes/";
var discipline_images_url = "http://files.vlabs.ac.in/lds/images/disciplines/";
var lab_images_url = "http://files.vlabs.ac.in/lds/images/labs/";
//set the below variable to "test-openedx" or "openedx"
var labs_hosted_platform = "test-openedx";
var OPENEDX_URL = "http://themeless.vlabs.ac.in";
#+END_SRC

** Index page on load 
   Every page has a controller, content and footer.  Both
   the content and the footer are served from iframes.  The
   content is either:
   1. list of disciplines
   2. list of institutes
   3. list of labs which can either be:
      1. labs of a discipline
      2. labs of an institute or
      3. all labs
      or
   4. the lab itself. 

   On the initial load,  the content lists all the
   disciplines.  
#+NAME: load-index
#+BEGIN_SRC javascript
var loadIndex = function() {
  console.log("=======loading index page=====");
  var disciplinesDivContent = createDisciplinesDivContent();
  var cIframe = createIframeForContent();
  cIframe = setDisciplineSourceToIframe(cIframe);
  var fIframe = createIframeForFooter();
  fIframe = setFooterSourceToIframe(fIframe);
  setContentForIframe(disciplinesDivContent, cIframe);
  insertContentIframe(cIframe);
  insertFooterIframe(fIframe);
};

#+END_SRC
** setting Footer Source To Iframe
#+NAME: set-footer-source-to-iframe
#+BEGIN_SRC javascript 
var setFooterSourceToIframe = function(fIframe) {
  fIframe.src = "./footer.html";
  return fIframe;
}
#+END_SRC

** setting Content For Iframe
#+NAME: set-content-for-iframe
#+BEGIN_SRC javascript 
var setContentForIframe = function(disciplinesDivContent, cIframe) {
  var content = ciframe.contentWindow.document;
  console.log(content);
  content.body.innerHTML="";
  content.write(disciplinesDivContent);

}
#+END_SRC

** insert content iframe
#+NAME: insert-content-iframe
#+BEGIN_SRC javascript 
var insertContentIframe = function(cIframe) {
  var division = document.getElementById("contentDiv");
  insertFrameInDivision(cIframe, division.id);
}
#+END_SRC
** insert footer iframe
#+NAME: insert-footer-iframe
#+BEGIN_SRC javascript 
var insertFooterIframe = function(fIframe) {
  var division = document.getElementById("contentDiv");
  insertFrameInDivision(fIframe, division.id);
}
#+END_SRC

** create Iframe For Content
#+NAME: create-iframe-for-content
#+BEGIN_SRC javascript 
var createIframeForContent = function() {
  console.log("=======create Iframe For Content=====");
  var cIFrame = createNewIframe("contentIframe", "contentIframe", "100%", "9500em");
  return cIFrame
};

#+END_SRC

** create Iframe For Footer
#+NAME: create-iframe-for-footer
#+BEGIN_SRC javascript 
var createIframeForFooter = function() {
  console.log("=======create Iframe For Footer=====");
  var fIFrame = createNewIframe("footerIframe", "footerIframe", "100%", "390em");
  return fIFrame
};

#+END_SRC

** setting Discipline Source To Iframe
#+NAME: set-discipline-source-to-iframe
#+BEGIN_SRC javascript 
var setDisciplineSourceToIframe = function(cIframe) {
cIframe.src = "./disciplines.html";
return cIframe
}
#+END_SRC
** Create a frame
   Provide the attributes, and an iframe is created and
   returned.  The attributes are name, id, width and height
   of the frame.
#+NAME: create-new-iframe
#+BEGIN_SRC javascript 
var createNewIframe = function(name, id, width, height) {
  console.log("=======creating new frame=====");
  var newIframe = document.createElement("iframe");
  newIframe.setAttribute("width", width);
  newIframe.setAttribute("height", height);
  newIframe.setAttribute("frameBorder", "0");
  newIframe.name = name;
  newIframe.id = id;
  return newIframe;
};

#+END_SRC

** Insert a Frame in a Division
   Given a division, and an iframe, the iframe is inserted
   in the division.
#+NAME: insert-frame-in-division
#+BEGIN_SRC javascript 
var insertFrameInDivision = function(iframe, divId) {
  console.log("=======inserting iframe in division=====");
  var divElem = parent.document.getElementById(divId);
  divElem.appendChild(iframe);
};

#+END_SRC

** style sheets
#+NAME: style-sheets
#+BEGIN_SRC css
@import url(https://fonts.googleapis.com/css?family=Raleway:400,300,700,500,600);
body {
 /* font-family: 'Open Sans', 'sans-serif';*/
 font-family:'Raleway' !important;
}

p{
font-family:'Raleway' !important;
}
.mega-dropdown {
  position: static !important;
}
.mega-dropdown-menu .dropdown-header {
  font-size: 18px;
  font-family:'Raleway' !important;
  color:  #5FB0E4;
  padding: 5px 60px 5px 5px;
  line-height: 30px;
}

.mega-dropdown-menu > li > ul {
    font-family:'Raleway' !important;
    padding: 0;
    margin: 0;
}
.mega-dropdown-menu > li > ul > li {
  list-style: none;
}
.mega-dropdown-menu > li > ul > li > a {
  display: block;
  color: #222;
  padding: 3px 5px;
  font-size:16px;
}
.mega-dropdown-menu > li ul > li > a:hover,
.mega-dropdown-menu > li ul > li > a:focus {
  text-decoration: none;
}

.carousel-control {
  width: 30px;
  height: 30px;
  top: -35px;

}
.left.carousel-control {
  right: 30px;
  left: inherit;
}
.carousel-control .glyphicon-chevron-left, 
.carousel-control .glyphicon-chevron-right {
  font-size: 12px;
  background-color: #fff;
  line-height: 30px;
  text-shadow: none;
  color: #333;
  border: 1px solid #ddd;
}
.contentDiv{
position:absolute;
height:650px;
}
.row {
    margin-right: 0px;
    margin-left: -15px;
}
.text-h3-darkblack-bold {
    font-size: 1.4em;
    font-weight: bold;
}

.navbar-bootsnipp .navbar-nav > li > .dropdown-menu > li > a {
  display: inline-block;
  margin-right: -4px;
  font-size: 14px;
  padding: 0px 20px; !important;
  font-family:'Raleway' !important;
}


/* search placeholder styles */
}
.stylish-input-group .input-group-addon{
    background: white !important; 
}
.stylish-input-group .form-control{
	border-right:0; 
	box-shadow:0 0 0; 
	border-color:#ccc;
}
.stylish-input-group button{
    border:0;
    background:transparent;
}
/*overwrting the search icon properties from less bootstrap library*/
.input-group-addon {
    
    padding: 0px 0px !important;
    font-size: 0px !important;
    font-weight: 400;
    line-height: 1;
    color: #555;
    text-align: center;
    background-color: #fff !important;
    border: 1px solid #ccc;
    border-left-width: 1px;
    border-left-style: solid;
    border-left-color: rgb(204, 204, 204);
    border-radius: 4px;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;

}

/* search icon hover color properties */
.btn-default:hover {
    color: #333;
    color: #007db8;
    border-color: #adadad;
    background-color: #fff !important;
}

.thumbnail {
    display: block;
    padding: 0px !important;
    margin-bottom: 20px;
    line-height: 1.42857143;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    
}

.cursor-pointer{cursor: pointer;}

.navbar-default .navbar-nav > li > a:focus, .navbar-default .navbar-nav > li > a:hover
{
color:#5FB0E4 !important;


}

.navbar-default .navbar-nav{
font-size:16px;
}
.dropdown-menu{
cursor: pointer !important;
border-left: 0 solid #5FB0E4 !important;
font-size:16px;
}



#+END_SRC

** Favicon
#+NAME: favicon
#+BEGIN_SRC javascript 
master = window.parent.document;
head = master.getElementsByTagName("head")[0];
favicon = master.createElement("link");
favicon.rel = "shortcut icon";
favicon.type = "image/png";
favicon.href = "http://files.vlabs.ac.in/lds/images/vlabs-logo/favicon.ico";
head.appendChild(favicon);

#+END_SRC

* Tangle 
** sources
*** Javascript
**** Main JS
#+BEGIN_SRC javascript :tangle static/js/main.js :eval no :noweb yes 
<<load-index>>
<<set-footer-source-to-iframe>>
<<set-content-for-iframe>>
<<insert-content-iframe>>
<<insert-footer-iframe>>
<<create-iframe-for-content>>
#+END_SRC
*** Config
#+BEGIN_SRC javascript :tangle static/js/app-config.js :eval no :noweb yes 
<<app-config>>
#+END_SRC
*** HTML
#+BEGIN_SRC html :tangle templates/header.html :eval no :noweb yes
<<header-html>>
#+END_SRC
#+BEGIN_SRC html :tangle templates/main.html :eval no :noweb yes
<<main-html>>
#+END_SRC
#+BEGIN_SRC html :tangle templates/content.html :eval no :noweb yes
<<content-html>>
#+END_SRC

*** CSS
#+BEGIN_SRC css :tangle static/css/style.css :eval no :noweb yes 
<<style-sheets>>
#+END_SRC
