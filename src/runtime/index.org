#+TITLE: Runtime
#+AUTHOR: VLEAD
#+DATE: [2017-04-06 Thursday]
#+PROPERTY: results output
#+PROPERTY: exports code
#+SETUPFILE: ../org-templates/level-1.org
#+options: ^:nil
#+LATEX: Literal LaTeX code for export

* Introduction 
  :PROPERTIES:
  :CUSTOM_ID: introduction
  :END: 
  
  This document illustrates building of  =Vlabs landing Pages= dynamically.
  Data will be provided by =Lab Data Service=.
* Web App
** Index HTML
#+BEGIN_SRC html :tangle index.html :eval no :noweb yes
<html>
   <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./main.js"></script>
  </head>
  <body>
    <div class="container">
      <iframe id="headerIframe" width="100%" height="150em"  src="./header.html" name="header_iframe"></iframe>
      <iframe id="bodyIframe" width="100%" height="450em"
              src="./body_iframe.html" name="body_iframe">
      </iframe>
    </div>
  </body>
</html>

#+END_SRC

** Body IFrame
#+BEGIN_SRC html :tangle body_iframe.html :eval no :noweb yes
<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./main.js"></script>
  </head>  
  <body>
    <div id="content">welcome to virutal labs</div>
  </body>
</html>

#+END_SRC

** JS
#+BEGIN_SRC javascript :tangle main.js :eval no :noweb yes
var base_url = 'http://localhost:5000';
var keyword_url = base_url+"/labs?keyword_lab_name="

 $(document).ready(function() {
   getAllInstitutes();
   getAllDisciplines();
//   $("button").click(function(){
//     getLabs();
//   });
 });

function getLabs(){
  var keyword = document.getElementById("keyword").value;
  var lab_url = keyword_url+keyword;
  console.log("============keyword==========");
  console.log(lab_url);
  manageFrames(lab_url);
  $.getJSON(lab_url, function(data) {
    console.log(lab_url);
    var items = '';
    $.each(data, function(key, value){
      lab_name = value['lab_name'];
      hosted_url = value['hosting_info'][0]['hosted_url'];
      //      image =value['assets'][0]['path']
        items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
        + lab_name +'<div class="thumbnail"></a></div></div>';
      
      //      items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
      //        + lab_name +'<div class="thumbnail"><img src='+ image +'></img></a></div></div>';
    });
    console.log(items);
    manageFrames(items);
      //$('#content').append(items);
  })
    .done(function() {
      console.log( "second success" );
    })
    .fail(function() {
      console.log(jqXHR);
      console.log( "error in getAllkeyword labs" );
    })
    .alert();ways(function() {
      console.log( "complete" );
    });

}


function manageFrames(items){
  console.log("manageFrames");
  var elem = parent.frames["body_iframe"].document.getElementById("content");
  console.log("elem = " + elem);
  console.log("new htdfdfml = " + items);
  elem.innerHTML = items;
}

function getSignInPage(){
  items = "<html><head><body><div><ul><li><a href='http://vlabs.ac.in'>hello</a></li></ul><p>hello></p></div></body></head></html>"
  manageFrames(items)
}

function getAllInstitutes(){
  console.log("getallinstitutes");
  var inst_url = base_url+"/institutes";
  $.getJSON(inst_url, function(data) {
    var items = '';
    $.each(data, function(key, value){
      inst_name = value['institute_name'];
      items += '<li onclick="getLabsByInstitute()" value="' + inst_name +
        '" id="' + inst_name + '"><a href="#">' +
        inst_name + '</a></li>';
    });
    
    $('.filterInstComboBox').append(items);
  })
    .done(function() {
      console.log( "second success" );
    })
    .fail(function() {
      console.log( "error" );
      location.reload();
    })
    .always(function() {
      console.log( "complete" );
    });
}
function getAllDisciplines(){
  dis_url = base_url+"/disciplines";
  $.getJSON(dis_url, function(data) {
    var items = '';
    $.each(data, function(key, value){
      dis_name = value['discipline_name'];
      items += '<li onclick="getLabsByDiscipline()" value="' + dis_name +
        '" id="' + dis_name + '"><a href="#">' +
        dis_name + '</a></li>';
    });
    $('.filterDisComboBox').append(items);
  })
    .done(function() {
      console.log( "second success" );
    })
    .fail(function() {
      console.log( "error" );
    })
    .always(function() {
      console.log( "complete" );
    });
}
function getLabsByDiscipline() {
  $("#getDisName li").click(function() {
    labs_url = base_url+"/labs";
    labs_by_dis_url = labs_url+"?discipline_name="+($(this).text());
    console.log(labs_by_dis_url);
    $.getJSON(labs_by_dis_url, function(data) {
      var items = '';
      $.each(data, function(key, value){
        lab_name = value['lab_name'];
        hosted_url = value['hosting_info'][0]['hosted_url'];
//        image =value['assets'][0]['path']
//        items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
//          + lab_name +'<div class="thumbnail"><img src='+ image +'></img></a></div></div>';
        items += '  <span id="getLabsbyDis"></span><div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
          + lab_name +'<div class="thumbnail"></a></div></div>';
      });
      manageFrames(items);

    })
      .done(function() {
        console.log( "second success" );
      })
      .fail(function() {
        console.log( "error" );
        location.reload();
      })
      .always(function() {
        console.log( "complete" );
      });

  });
}
function getLabsByInstitute() {
  $("#getInstName li").click(function() {
    labs_url = base_url+"/labs";
    labs_by_inst_url = labs_url+"?institute_name="+($(this).text());
    console.log(labs_by_inst_url);
    $.getJSON(labs_by_inst_url, function(data) {
      var items = '';
      $.each(data, function(key, value){
        lab_name = value['lab_name'];
        hosted_url = value['hosting_info'][0]['hosted_url'];
//        image =value['assets'][0]['path']
//        items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
//          + lab_name +'<div class="thumbnail"><img src='+ image +'></img></a></div></div>';

        items += '  <span id="getLabsbyInst"></span><div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
          + lab_name +'<div class="thumbnail"></a></div></div>';

//        items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
//          + lab_name +'<div class="thumbnail"></a></div></div>';
      });
      manageFrames(items);
    })
      .done(function() {
        console.log( "second success" );
      })
      .fail(function() {
        console.log( "error" );
        location.reload();
      })
      .always(function() {
        console.log( "complete" );
      });

  });
}
  
lab_url = base_url+"/labs";

function getAllLabs() {
  $.getJSON(lab_url, function(data) {
    var items = '';
    $.each(data, function(key, value){
      lab_name = value['lab_name'];
      hosted_url = value['hosting_info'][0]['hosted_url'];
//      image =value['assets'][0]['path']
      items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
        + lab_name +'<div class="thumbnail"></a></div></div>';

//      items += '<div class="col-md-4" id=' + lab_name + '><a href='+ hosted_url + '>'
//        + lab_name +'<div class="thumbnail"><img src='+ image +'></img></a></div></div>';
    });
    manageFrames(items);
    //$('#content').append(items);
  })
    .done(function() {
      console.log( "second success" );
    })
    .fail(function() {
      console.log(jqXHR);
      console.log( "error in getAllLabs" );
    })
    .always(function() {
      console.log( "complete" );
    });
}
    
#+END_SRC
   
** Footer
#+BEGIN_SRC html :tangle footer.html :eval no :noweb yes 
<head>
  <link rel="stylesheet" type="text/css" href="static/css/main.css">
</head>

<footer>
  <div class="container-fluid footer-div" style="background: #404040; margin-top: 40px;  padding: 20px;">
    <div class="col-md-4 border-right-green-dotted" >
      <h2 class="text-h2-lightblue-small" style="font-weight: bold;margin-top: 0px;">Updates</h2>
      <a href="http://community.virtual-labs.ac.in/w/index.php/Download" class="text-normal-gray-small nounderline" style="color: white" > Lab Integration Kit Releases</a><br>
      <a href="http://community.virtual-labs.ac.in/w/index.php/First_Integration_workshop"
	 class="text-normal-gray-small nounderline"
	 style="color: white" >First Integration Workshop at IIIT Hyderabad</a><br>
      <a href="http://community.virtual-labs.ac.in/w/index.php/Summer_Sprint_Integration_workshop" class="text-normal-gray-small nounderline" style="color: white" > Summer Integration Workshop at IIT Guwahati</a><br>
      <a href="http://community.virtual-labs.ac.in/w/index.php/QA/Integration_workshop"
	 class="text-normal-gray-small nounderline"
	 style="color: white" > QA Integration
	Workshop at IIIT Hyderabad</a><br>
      <a href="http://community.virtual-labs.ac.in/w/index.php/A_new_set_of_25_Virtual_Labs_on_Portable_Media" class="text-normal-gray-small nounderline" style="color: white" > A new set of 25 Virtual Labs on Portable Media</a><br>
    </div>
    
    <div class="col-md-2 border-right-green-dotted" >

<!--      <a href="./faq.html" class="text-a-lightgreen" style="text-decoration: underline;" > FAQ</a><br>-->
      <a href="http://community.virtual-labs.ac.in/w/index.php/Main_Page" class="text-a-lightgreen" style="text-decoration: underline;" >Community</a><br>
      
      <a href="http://outreach.vlabs.ac.in/ncentres"
	 class="text-a-lightgreen"
	 style="text-decoration: underline;" > Nodal Centers</a><br>
      
      
      <a href="http://www.sakshat.ac.in/" class="text-a-lightgreen" style="text-decoration: underline;" > Sakshat Portal</a><br>

      <a href="http://outreach.vlabs.ac.in/" class="text-a-lightgreen" style="text-decoration: underline;" > Outreach Portal</a><br>
      <a href="http://118.102.191.38/vlabiitece/"
	 class="text-a-lightgreen"
	 style="text-decoration: underline;" > Labs
	Developed by Nodal Centers</a><br>
      
    </div>
    
    <div class="col-md-3 border-right-green-dotted" id="contact" >
      <h2 class="text-h2-lightblue-small" style="font-weight: bold;margin-top: 0px;"> Contact us</h2>
      <a href="http://feedback.vlabs.ac.in/" class="text-a-lightgreen" style="text-decoration: underline;" > Feedback</a><br>
      
      <a class="text-a-lightgreen"style="text-decoration: underline;" href="mailto:support@vlabs.ac.in">support@vlabs.ac.in</a><br>
      <a href="http://118.102.191.38/labassessment/assessmentform.html"
	 class="text-a-lightgreen"
	 style="text-decoration: underline;" > Lab
	Assessment Form</a><br>

    </div>
    
                        
    <div class="col-md-2 border-right-green-dotted" >
      <h2 class="text-h2-lightblue-small" style="font-weight: bold;margin-top: 0px;"> Follow us</h2>
      <a href="https://www.facebook.com/pages/Virtual-Labs-IIT-Delhi/301510159983871" class="text-a-lightgreen nounderline"   target="_blank"> <img src="http://vlabs.ac.in/images/social/fb.png"  style="border-radius: 50%;"/> </a><br>
      <a href="https://twitter.com/TheVirtualLabs" class="text-a-lightgreen nounderline"   target="_blank"> <img src="http://vlabs.ac.in/images/social/twitter.png"  style="border-radius: 50%;"/></a><br>
      <a href="http://linkedin.com" class="text-a-lightgreen nounderline"  target="_blank" > <img src="http://vlabs.ac.in/images/social/linkedin.png" style="border-radius: 50%;" /></a><br>
      <a href="https://www.youtube.com/watch?v=mVBYNXLaDdg"
	 class="text-a-lightgreen nounderline"
	 target="_blank" >
	<img src="http://vlabs.ac.in/images/social/youtube.png"
	     style="border-radius: 50%; width: 38px;
		    height: 38px" /></a><br>
      
    </div>
    
  </div>
</footer>

#+END_SRC
** Header
#+BEGIN_SRC html :tangle header.html :eval no :noweb yes

<header >
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="js/bootstrap.css">
  <link rel="stylesheet" href="js/font-awesome.css">
  <link rel="stylesheet" href="js/bootsnipp.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="./main.js"></script>
  <nav class="navbar navbar-fixed-top navbar-bootsnipp animate" role="navigation" style="z-index: 9999999">

    <div class="container-fluid">

      <div class="navbar-header">
        <a class="navbar-brand main-logo-a" href="https://vlabs.ac.in" style=" width:100px; height:40px; margin-top:-13px"><img src="https://vlabs.ac.in/static/edx-bootstrap-theme/images/logo.7e034286282a.png" class="img-responsive main-logo" style="width:100%; maring-top:2px;"></a>

      </div>

      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>

        <li class="dropdown" ><a class="dropdown-toggle" data-toggle="dropdown" href="#">Institutes <span class="caret"></span></a>
          <ul class="dropdown-menu filterInstComboBox" id="getInstName">
          </ul>
          
        <li class="dropdown" ><a class="dropdown-toggle" data-toggle="dropdown" href="#">Disciplines <span class="caret"></span></a>
          <ul class="dropdown-menu filterDisComboBox" id="getDisName">
          </ul></li>
          
        <li><a href="javascript:getAllLabs()" target="body_iframe">All
            Labs</a></li>
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <form class="navbar-form navbar-left">
          <div class="input-group">
            <input id="keyword" type="text" class="form-control" placeholder="Lab Name">
            <div class="input-group-btn">
              <button onclick="javascript:getLabs()" target="body_iframe" class="btn btn-default" type="submit">
                <i class="glyphicon glyphicon-search"></i>
              </button>
            </div>
          </div>
        </form>        
        <li><a href="http://vlabs.ac.in" target="body_iframe"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
      <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
    </ul>

    </div>
  </nav>

</header>

#+END_SRC
